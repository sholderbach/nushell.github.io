(window.webpackJsonp=window.webpackJsonp||[]).push([[924],{1440:function(a,t,s){"use strict";s.r(t);var e=s(35),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"并行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#并行"}},[a._v("#")]),a._v(" 并行")]),a._v(" "),s("p",[a._v("Nushell 现在已经初步支持并行运行代码了，这允许你使用更多的计算机硬件资源来处理一个流的各个元素。")]),a._v(" "),s("p",[a._v("你会注意到这些命令包含其特有的"),s("code",[a._v("par-")]),a._v("命名，每一个都对应着一个非并行的版本，这允许你先轻松地以串行的风格写代码，然后再回头用几个额外的字符轻松地将串行脚本转换成并行脚本。")]),a._v(" "),s("h2",{attrs:{id:"par-each"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#par-each"}},[a._v("#")]),a._v(" "),s("code",[a._v("par-each")])]),a._v(" "),s("p",[a._v("最常见的并行命令是"),s("RouterLink",{attrs:{to:"/book/commands/par-each.html"}},[s("code",[a._v("par-each")])]),a._v("，它是"),s("RouterLink",{attrs:{to:"/book/commands/each.html"}},[s("code",[a._v("each")])]),a._v("命令的搭档。")],1),a._v(" "),s("p",[a._v("与"),s("RouterLink",{attrs:{to:"/book/commands/each.html"}},[s("code",[a._v("each")])]),a._v("一样，"),s("RouterLink",{attrs:{to:"/book/commands/par-each.html"}},[s("code",[a._v("par-each")])]),a._v("对管道中流入的元素进行处理，在每个元素上运行一个代码块。与"),s("RouterLink",{attrs:{to:"/book/commands/each.html"}},[s("code",[a._v("each")])]),a._v("不同，"),s("RouterLink",{attrs:{to:"/book/commands/par-each.html"}},[s("code",[a._v("par-each")])]),a._v("将并行地进行这些操作。")],1),a._v(" "),s("p",[a._v("假设你想计算当前目录下每个子目录下的文件数量。使用"),s("RouterLink",{attrs:{to:"/book/commands/each.html"}},[s("code",[a._v("each")])]),a._v("你可以这样写。")],1),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" where "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" each "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("it"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" name: "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$it")]),a._v(".name, len: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ls "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$it")]),a._v(".name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("我们为每个条目创建一条记录，并在其中填入目录的名称和该子目录中的文件数。")]),a._v(" "),s("p",[a._v("在你的机器上，时间可能有所不同。对于这台机器的当前目录来说，需要 21 毫秒的时间。")]),a._v(" "),s("p",[a._v("现在，由于这个操作可以并行运行，让我们把上面的操作转换为并行的，把"),s("RouterLink",{attrs:{to:"/book/commands/each.html"}},[s("code",[a._v("each")])]),a._v("改为"),s("RouterLink",{attrs:{to:"/book/commands/par-each.html"}},[s("code",[a._v("par-each")])]),a._v("：")],1),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" where "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" par-each "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("it"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" name: "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$it")]),a._v(".name, len: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ls "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$it")]),a._v(".name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("在这台机器上，现在它的运行时间为 6 毫秒。这是一个相当大的差异!")]),a._v(" "),s("p",[a._v("顺便提一下：由于 "),s("RouterLink",{attrs:{to:"/zh-CN/book/environment.html#作用域"}},[a._v("环境变量是有作用域的")]),a._v("，你可以使用"),s("code",[a._v("par-each")]),a._v("在多个目录中并行工作（注意 "),s("code",[a._v("cd")]),a._v(" 命令）：")],1),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" where "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" par-each "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("it"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" name: "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$it")]),a._v(".name, len: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cd "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$it")]),a._v(".name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v('如果你看一下结果，你会注意到，它们每次运行返回的顺序是不同的（这取决于你系统上的硬件线程数量）。随着任务的完成，我们得到了正确的结果，如果我们希望得到结果以特定的顺序出现，我们可能需要添加额外的步骤。例如，对于上述情况，我们可能想按 "name" 字段对结果进行排序。这样，我们的脚本的'),s("RouterLink",{attrs:{to:"/book/commands/each.html"}},[s("code",[a._v("each")])]),a._v("和"),s("RouterLink",{attrs:{to:"/book/commands/par-each.html"}},[s("code",[a._v("par-each")])]),a._v("版本都能得到相同的结果。")],1)])}),[],!1,null,null,null);t.default=n.exports}}]);