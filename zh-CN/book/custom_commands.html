<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.60">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/icon.png"><title>自定义命令 | Nushell</title><meta name="description" content="一种新型的Shell">
    <link rel="preload" href="/assets/style-9c9951ef.css" as="style"><link rel="stylesheet" href="/assets/style-9c9951ef.css">
    <link rel="modulepreload" href="/assets/app-c9a81c0f.js"><link rel="modulepreload" href="/assets/framework-344bb0e4.js"><link rel="modulepreload" href="/assets/custom_commands.html-acb44097.js"><link rel="modulepreload" href="/assets/custom_commands.html-75c89037.js">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/zh-CN/" class=""><!----><span class="site-name">Nushell</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/zh-CN/book/" class="router-link-active" aria-label="书"><!--[--><!--]--> 书 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/cookbook/" class="" aria-label="Cookbook"><!--[--><!--]--> Cookbook <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/" class="" aria-label="博客"><!--[--><!--]--> 博客 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/book/custom_commands.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/zh-CN/book/custom_commands.html" class="router-link-active router-link-exact-active router-link-active" aria-label="中文"><!--[--><!--]--> 中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/" class="" aria-label="Español"><!--[--><!--]--> Español <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt-BR/" class="" aria-label="Português do Brasil"><!--[--><!--]--> Português do Brasil <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/nushell/nushell" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/zh-CN/book/" class="router-link-active" aria-label="书"><!--[--><!--]--> 书 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/cookbook/" class="" aria-label="Cookbook"><!--[--><!--]--> Cookbook <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/" class="" aria-label="博客"><!--[--><!--]--> 博客 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/book/custom_commands.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/zh-CN/book/custom_commands.html" class="router-link-active router-link-exact-active router-link-active" aria-label="中文"><!--[--><!--]--> 中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/" class="" aria-label="Español"><!--[--><!--]--> Español <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt-BR/" class="" aria-label="Português do Brasil"><!--[--><!--]--> Português do Brasil <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/nushell/nushell" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">入门篇 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/zh-CN/book/" class="router-link-active sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/installation.html" class="sidebar-item" aria-label="安装 Nu"><!--[--><!--]--> 安装 Nu <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/thinking_in_nu.html" class="sidebar-item" aria-label="以 Nushell 的方式思考"><!--[--><!--]--> 以 Nushell 的方式思考 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/moving_around.html" class="sidebar-item" aria-label="在系统中四处移动"><!--[--><!--]--> 在系统中四处移动 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Nu 基础篇 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/zh-CN/book/types_of_data.html" class="sidebar-item" aria-label="数据类型"><!--[--><!--]--> 数据类型 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/loading_data.html" class="sidebar-item" aria-label="加载数据"><!--[--><!--]--> 加载数据 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/working_with_strings.html" class="sidebar-item" aria-label="处理字符串"><!--[--><!--]--> 处理字符串 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/working_with_lists.html" class="sidebar-item" aria-label="处理列表"><!--[--><!--]--> 处理列表 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/working_with_tables.html" class="sidebar-item" aria-label="处理表格"><!--[--><!--]--> 处理表格 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/pipelines.html" class="sidebar-item" aria-label="管道"><!--[--><!--]--> 管道 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/command_reference.html" class="sidebar-item" aria-label="命令索引"><!--[--><!--]--> 命令索引 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Nushell 编程 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/zh-CN/book/custom_commands.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="自定义命令"><!--[--><!--]--> 自定义命令 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#命令名称" class="router-link-active router-link-exact-active sidebar-item" aria-label="命令名称"><!--[--><!--]--> 命令名称 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#子命令" class="router-link-active router-link-exact-active sidebar-item" aria-label="子命令"><!--[--><!--]--> 子命令 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#参数类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="参数类型"><!--[--><!--]--> 参数类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#具有默认值的参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="具有默认值的参数"><!--[--><!--]--> 具有默认值的参数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#可选位置参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="可选位置参数"><!--[--><!--]--> 可选位置参数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#标志" class="router-link-active router-link-exact-active sidebar-item" aria-label="标志"><!--[--><!--]--> 标志 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#剩余参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="剩余参数"><!--[--><!--]--> 剩余参数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#为命令添加文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="为命令添加文档"><!--[--><!--]--> 为命令添加文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#管道输出" class="router-link-active router-link-exact-active sidebar-item" aria-label="管道输出"><!--[--><!--]--> 管道输出 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#管道输入" class="router-link-active router-link-exact-active sidebar-item" aria-label="管道输入"><!--[--><!--]--> 管道输入 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh-CN/book/custom_commands.html#持久化" class="router-link-active router-link-exact-active sidebar-item" aria-label="持久化"><!--[--><!--]--> 持久化 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/zh-CN/book/aliases.html" class="sidebar-item" aria-label="别名"><!--[--><!--]--> 别名 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/operators.html" class="sidebar-item" aria-label="运算符"><!--[--><!--]--> 运算符 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/variables_and_subexpressions.html" class="sidebar-item" aria-label="变量和子表达式"><!--[--><!--]--> 变量和子表达式 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/scripts.html" class="sidebar-item" aria-label="脚本"><!--[--><!--]--> 脚本 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/modules.html" class="sidebar-item" aria-label="模块"><!--[--><!--]--> 模块 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/overlays.html" class="sidebar-item" aria-label="覆层"><!--[--><!--]--> 覆层 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Nu 作为 Shell 使用 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/zh-CN/book/configuration.html" class="sidebar-item" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/environment.html" class="sidebar-item" aria-label="环境"><!--[--><!--]--> 环境 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/stdout_stderr_exit_codes.html" class="sidebar-item" aria-label="标准输入、输出和退出码"><!--[--><!--]--> 标准输入、输出和退出码 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/escaping.html" class="sidebar-item" aria-label="转移到系统"><!--[--><!--]--> 转移到系统 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/3rdpartyprompts.html" class="sidebar-item" aria-label="配置第三方提示"><!--[--><!--]--> 配置第三方提示 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/shells_in_shells.html" class="sidebar-item" aria-label="Shell 中的 Shell"><!--[--><!--]--> Shell 中的 Shell <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/line_editor.html" class="sidebar-item" aria-label="Reedline，Nu 的行编辑器"><!--[--><!--]--> Reedline，Nu 的行编辑器 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/externs.html" class="sidebar-item" aria-label="外部命令"><!--[--><!--]--> 外部命令 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/custom_completions.html" class="sidebar-item" aria-label="自定义补全"><!--[--><!--]--> 自定义补全 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/coloring_and_theming.html" class="sidebar-item" aria-label="Nu 的配色和主题"><!--[--><!--]--> Nu 的配色和主题 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/hooks.html" class="sidebar-item" aria-label="钩子"><!--[--><!--]--> 钩子 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">迁移到 Nu <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/zh-CN/book/coming_from_bash.html" class="sidebar-item" aria-label="从 Bash 到 Nu"><!--[--><!--]--> 从 Bash 到 Nu <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/nushell_map.html" class="sidebar-item" aria-label="从其他 Shell 或 DSL 到 Nu"><!--[--><!--]--> 从其他 Shell 或 DSL 到 Nu <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/nushell_map_imperative.html" class="sidebar-item" aria-label="从命令式语言到 Nu"><!--[--><!--]--> 从命令式语言到 Nu <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/nushell_map_functional.html" class="sidebar-item" aria-label="从函数式语言到 Nu"><!--[--><!--]--> 从函数式语言到 Nu <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/nushell_operator_map.html" class="sidebar-item" aria-label="Nushell 运算符"><!--[--><!--]--> Nushell 运算符 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">高级篇 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/zh-CN/book/dataframes.html" class="sidebar-item" aria-label="DataFrames"><!--[--><!--]--> DataFrames <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/metadata.html" class="sidebar-item" aria-label="元数据"><!--[--><!--]--> 元数据 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/creating_errors.html" class="sidebar-item" aria-label="创建你自己的错误"><!--[--><!--]--> 创建你自己的错误 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/parallelism.html" class="sidebar-item" aria-label="并行"><!--[--><!--]--> 并行 <!--[--><!--]--></a><!----></li><li><a href="/zh-CN/book/plugins.html" class="sidebar-item" aria-label="插件"><!--[--><!--]--> 插件 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="自定义命令" tabindex="-1"><a class="header-anchor" href="#自定义命令" aria-hidden="true">#</a> 自定义命令</h1><p>Nu 具备组合长管道的能力使你对数据和系统有很强的控制力，但它的代价是需要大量的键盘输入。不过理想情况下，你可以保存精心设计的管道以便反复使用。</p><p>这就是自定义命令(Custom Commands)的作用。</p><p>下面看一个自定义命令的例子：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello&quot;</span> <span class="token variable">$name</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这个定义中，我们定义了<code>greet</code>命令，它需要一个参数<code>name</code>。在这个参数后面是自定义命令运行时将执行的代码块。当被调用时，自定义命令将把传递给<code>name</code>的值设置为<code>$name</code>变量，该变量在块内是可用的。</p><p>要运行上述命令，我们可以像调用内置命令一样调用它：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> greet <span class="token string">&quot;world&quot;</span>
</code></pre></div><p>当我们这样做的时候，就会得到输出，如同我们使用内置命令一样：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>───┬───────
 0 │ hello
 1 │ world
───┴───────
</code></pre></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>echo</code>将其参数分别返回给管道。如果你想用它来生成一个单一的字符串，请在管道中添加<code> | str join</code>：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello &quot;</span> <span class="token variable">$name</span> <span class="token operator">|</span> str <span class="token function">join</span>
<span class="token punctuation">}</span>

greet nushell
</code></pre></div><p>返回 <code>hello nushell</code></p></div><h2 id="命令名称" tabindex="-1"><a class="header-anchor" href="#命令名称" aria-hidden="true">#</a> 命令名称</h2><p>在 Nushell 中，命令名是一串字符或一个带引号的字符串。下面是一些有效命令名的例子：<code>greet</code>, <code>get-size</code>, <code>mycommand123</code>, <code>&quot;mycommand&quot;</code>, <code>😊</code>, 和<code>123</code>。</p><p><em>注意：在 Nushell 中，通常的做法是用<code>-</code>来分隔命令的多个单词，以提高可读性。</em> 例如，使用 <code>get-size</code> 而不是 <code>getsize</code> 或者 <code>get_size</code>。</p><h2 id="子命令" tabindex="-1"><a class="header-anchor" href="#子命令" aria-hidden="true">#</a> 子命令</h2><p>你也可以使用空格来定义命令的子命令(Subcommand)。例如，如果我们想给<code>str</code>添加一个新的子命令，可以通过命名我们的子命令以 &quot;str&quot; 开头来做到。比如：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def <span class="token string">&quot;str mycommand&quot;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> hello
<span class="token punctuation">}</span>
</code></pre></div><p>现在我们可以像调用<code>str</code>的内置子命令一样调用我们的自定义命令：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> str mycommand
</code></pre></div><h2 id="参数类型" tabindex="-1"><a class="header-anchor" href="#参数类型" aria-hidden="true">#</a> 参数类型</h2><p>在定义自定义命令时，你可以为每个参数命名并选择性地设置其类型。例如，你可以把上面的内容写成：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>name: string<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello &quot;</span> <span class="token variable">$name</span> <span class="token operator">|</span> str <span class="token function">join</span>
<span class="token punctuation">}</span>
</code></pre></div><p>参数的类型是可选的。Nushell 支持不添加类型，此时会把参数类型当作<code>any</code>。如果你在参数上标注了一个类型，Nushell 将在你调用函数的时候检查该类型。</p><p>例如，假设你需要输入一个<code>int</code>类型：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>name: int<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello &quot;</span> <span class="token variable">$name</span> <span class="token operator">|</span> str <span class="token function">join</span>
<span class="token punctuation">}</span>

greet world
</code></pre></div><p>如果我们尝试运行上述内容，Nushell 会告诉我们，类型不匹配：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>error: Type Error
  ┌─ shell:6:7
  │
5 │ greet world
  │       ^^^^^ Expected int, found world
</code></pre></div><p>这可以帮助指导你的用户只使用支持的类型来调用你所定义的命令。</p><p>目前可以支持的类型是（从 0.65.0 版本开始）：</p><ul><li><code>any</code></li><li><code>block</code></li><li><code>cell-path</code></li><li><code>duration</code></li><li><code>path</code></li><li><code>expr</code></li><li><code>filesize</code></li><li><code>glob</code></li><li><code>int</code></li><li><code>math</code></li><li><code>number</code></li><li><code>operator</code></li><li><code>range</code></li><li><code>cond</code></li><li><code>bool</code></li><li><code>signature</code></li><li><code>string</code></li><li><code>variable</code></li><li><code>record</code></li><li><code>list</code></li><li><code>table</code></li><li><code>error</code></li></ul><h2 id="具有默认值的参数" tabindex="-1"><a class="header-anchor" href="#具有默认值的参数" aria-hidden="true">#</a> 具有默认值的参数</h2><p>若要使一个参数成为可选的，并具有默认值，你可以在命令定义中指定该默认值：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>name <span class="token operator">=</span> <span class="token string">&quot;nushell&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello &quot;</span> <span class="token variable">$name</span> <span class="token operator">|</span> str <span class="token function">join</span>
<span class="token punctuation">}</span>
</code></pre></div><p>你可以在没有参数的情况下调用这个命令，也可以指定一个值来覆盖默认值：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>&gt; greet
hello nushell
&gt; greet world
hello world
</code></pre></div><p>你也可以将默认值与<a href="#%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B">类型要求</a>相结合：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>def congratulate [age: int = 18] {
  echo &quot;Happy birthday! Wow you are &quot; $age &quot; years old now!&quot; | str join
}
</code></pre></div><p>如果你想检查一个可选参数是否存在，而不是仅仅依赖一个默认值，请使用<a href="#%E5%8F%AF%E9%80%89%E4%BD%8D%E7%BD%AE%E5%8F%82%E6%95%B0">可选位置参数</a>代替。</p><h2 id="可选位置参数" tabindex="-1"><a class="header-anchor" href="#可选位置参数" aria-hidden="true">#</a> 可选位置参数</h2><p>默认情况下，位置参数(Positional Parameters)是必须的。如果没有传递位置参数，我们将遇到一个报错：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>  × Missing required positional argument.
   ╭─[entry #23:1:1]
 1 │ greet
   ·      ▲
   ·      ╰── missing name
   ╰────
  help: Usage: greet &lt;name&gt;
</code></pre></div><p>我们可以在一个位置参数的名字后面加上一个问号（<code>?</code>），将其标记为可选参数。比如：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>name?: string<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello&quot;</span> <span class="token variable">$name</span> <span class="token operator">|</span> str <span class="token function">join</span>
<span class="token punctuation">}</span>

greet
</code></pre></div><p>使一个位置参数成为可选参数并不改变它在命令体中被访问的名称。如上例所示，尽管参数列表中有<code>?</code>的后缀，但它仍然以<code>$name</code>的形式被访问。</p><p>当一个可选参数没有被传递，它在命令体中的值等于<code>null</code>和<code>$nothing</code>。我们可以利用这一点来对没有传递参数的情况进行处理：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>name?: string<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello, I don&#39;t know your name!&quot;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello &quot;</span> <span class="token variable">$name</span> <span class="token operator">|</span> str <span class="token function">join</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

greet
</code></pre></div><p>如果你只是想在参数缺失时设置一个默认值，那么使用<a href="#%E5%85%B7%E6%9C%89%E9%BB%98%E8%AE%A4%E5%80%BC%E7%9A%84%E5%8F%82%E6%95%B0">默认值</a>来代替就更简单了。</p><p>如果必需的和可选的位置参数一起使用，那么必需的参数必须先出现在定义中。</p><h2 id="标志" tabindex="-1"><a class="header-anchor" href="#标志" aria-hidden="true">#</a> 标志</h2><p>除了传递位置参数之外, 你还可以通过为自定义命令定义标志(Flags)来传递命名参数。</p><p>比如：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>
  name: string
  --age: int
<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token variable">$name</span> <span class="token variable">$age</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在上面的<code>greet</code>定义中，我们定义了<code>name</code>位置参数以及<code>age</code>标志。这允许<code>greet</code>的调用者也可以选择传递<code>age</code>参数。</p><p>你可以用以下方法调用上述内容：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> greet world <span class="token parameter variable">--age</span> <span class="token number">10</span>
</code></pre></div><p>或者：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> greet <span class="token parameter variable">--age</span> <span class="token number">10</span> world
</code></pre></div><p>或者甚至完全不使用标志：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>&gt; greet world
</code></pre></div><p>标志也可以指定一个缩写版本，这允许你传递一个更简单的标志，如同传递一个更容易阅读的全写标志那样。</p><p>让我们扩展前面的例子，为<code>age</code>添加一个缩写标志：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>
  name: string
  <span class="token parameter variable">--age</span> <span class="token punctuation">(</span>-a<span class="token punctuation">)</span>: int
<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token variable">$name</span> <span class="token variable">$age</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>注意：</em> 标志是以其全称命名的，所以上面的例子的命令体内需要使用<code>$age</code>而不是<code>$a</code>。</p><p>现在，我们可以使用缩写标志来调用这个新的定义：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>&gt; greet -a 10 hello
</code></pre></div><p>标志也可以作为基本开关使用，这意味着它们的存在或不存在被当作定义的参数。延伸前面的例子：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>
  name: string
  <span class="token parameter variable">--age</span> <span class="token punctuation">(</span>-a<span class="token punctuation">)</span>: int
  <span class="token parameter variable">--twice</span>
<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token variable">$twice</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$name</span> <span class="token variable">$name</span> <span class="token variable">$age</span> <span class="token variable">$age</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$name</span> <span class="token variable">$age</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>而这个定义可以通过如下方式调用：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>&gt; greet -a 10 --twice hello
</code></pre></div><p>或者只是没有开关标志：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>&gt; greet -a 10 hello
</code></pre></div><h2 id="剩余参数" tabindex="-1"><a class="header-anchor" href="#剩余参数" aria-hidden="true">#</a> 剩余参数</h2><p>在某些情况下, 你可能想定义一个需要任意数量的位置参数的命令。我们可以用一个剩余参数(Rest Parameter)来实现这一点，通过下面的<code>...</code>语法：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span><span class="token punctuation">..</span>.name: string<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello all:&quot;</span>
  <span class="token keyword">for</span> <span class="token variable">$n</span> <span class="token keyword">in</span> <span class="token variable">$name</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$n</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

greet earth mars jupiter venus
</code></pre></div><p>我们可以使用任意数量的参数来调用上述<code>greet</code>命令的定义，包括完全没有参数，所有的参数都将被收集到<code>$name</code>列表中。</p><p>剩余参数可以和位置参数一起使用：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>vip: string, <span class="token punctuation">..</span>.name: string<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello to our VIP &quot;</span> <span class="token variable">$vip</span> <span class="token operator">|</span> str <span class="token function">join</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;and hello to everybody else:&quot;</span>
  <span class="token keyword">for</span> <span class="token variable">$n</span> <span class="token keyword">in</span> <span class="token variable">$name</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$n</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#     $vip          $name</span>
<span class="token comment">#     ---- ------------------------</span>
greet moon earth mars jupiter venus
</code></pre></div><h2 id="为命令添加文档" tabindex="-1"><a class="header-anchor" href="#为命令添加文档" aria-hidden="true">#</a> 为命令添加文档</h2><p>为了更好地帮助用户使用你的自定义命令，也可以为其添加额外的命令和参数描述。</p><p>以我们之前的例子为例：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def greet <span class="token punctuation">[</span>
  name: string
  <span class="token parameter variable">--age</span> <span class="token punctuation">(</span>-a<span class="token punctuation">)</span>: int
<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token variable">$name</span> <span class="token variable">$age</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一旦定义完毕，我们可以运行<code>help greet</code>来获得该命令的帮助信息：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>Usage:
  &gt; greet &lt;name&gt; {flags}

Parameters:
  &lt;name&gt;

Flags:
  -h, --help: Display this help message
  -a, --age &lt;integer&gt;
</code></pre></div><p>你可以看到我们定义的参数和标志，以及所有命令都会得到的<code>-h</code>帮助标志。</p><p>为了改进这个帮助，我们可以在定义中加入描述，这些描述将在帮助中显示出来：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># A greeting command that can greet the caller</span>
def greet <span class="token punctuation">[</span>
  name: string      <span class="token comment"># The name of the person to greet</span>
  <span class="token parameter variable">--age</span> <span class="token punctuation">(</span>-a<span class="token punctuation">)</span>: int   <span class="token comment"># The age of the person</span>
<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token variable">$name</span> <span class="token variable">$age</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们给定义和参数添加的注释会作为描述出现在命令的<code>help</code>中。</p><p>现在，如果我们运行<code>help greet</code>，就会得到一些更友好的帮助文本：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>A greeting command that can greet the caller

Usage:
  &gt; greet &lt;name&gt; {flags}

Parameters:
  &lt;name&gt; The name of the person to greet

Flags:
  -h, --help: Display this help message
  -a, --age &lt;integer&gt;: The age of the person
</code></pre></div><h2 id="管道输出" tabindex="-1"><a class="header-anchor" href="#管道输出" aria-hidden="true">#</a> 管道输出</h2><p>自定义命令会像内置命令一样流式输出。例如，假设我们想重构这个管道：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">ls</span> <span class="token operator">|</span> get name
</code></pre></div><p>让我们把<a href="/commands/docs/ls.html" class=""><code>ls</code></a>移到我们编写的命令中：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def my-ls <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token function">ls</span> <span class="token punctuation">}</span>
</code></pre></div><p>我们就可以像使用<a href="/commands/docs/ls.html" class=""><code>ls</code></a>一样使用这个命令的输出：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>&gt; my-ls | get name
───┬───────────────────────
 0 │ myscript.nu
 1 │ myscript2.nu
 2 │ welcome_to_nushell.md
───┴───────────────────────
</code></pre></div><p>这让我们可以很容易地创建自定义命令并处理它们的输出。注意，我们不像其他语言那样使用返回语句，取而代之的是我们创建管道，而其输出数据流可以连接到其他管道。</p><h2 id="管道输入" tabindex="-1"><a class="header-anchor" href="#管道输入" aria-hidden="true">#</a> 管道输入</h2><p>如同其他命令一样，自定义命令也可以从管道中获取输入，这个输入会自动传递给自定义命令所使用的代码块。</p><p>让我们创建一个把所有接收值都加倍的命令：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def double <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  each <span class="token punctuation">{</span> <span class="token operator">|</span>it<span class="token operator">|</span> <span class="token number">2</span> * <span class="token variable">$it</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在，如果我们在一个管道中调用上述命令，就可以看到它对输入的处理结果：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>&gt; [1 2 3] | double
───┬─────
 0 │ 2
 1 │ 4
 2 │ 6
───┴─────
</code></pre></div><p>我们还可以使用<code>$in</code>变量来存储输入，以便在后面使用：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>def nullify <span class="token punctuation">[</span><span class="token punctuation">..</span>.cols<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">let</span> start <span class="token operator">=</span> <span class="token variable">$in</span>
  <span class="token variable">$cols</span> <span class="token operator">|</span> reduce <span class="token parameter variable">--fold</span> <span class="token variable">$start</span> <span class="token punctuation">{</span> <span class="token operator">|</span>col, <span class="token function">df</span><span class="token operator">|</span>
    <span class="token variable">$df</span> <span class="token operator">|</span> upsert <span class="token variable">$col</span> null
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="持久化" tabindex="-1"><a class="header-anchor" href="#持久化" aria-hidden="true">#</a> 持久化</h2><p>关于如何持久化自定义命令，以便在你启动 Nushell 时它们是可用的，请参阅 <a href="/zh-CN/book/configuration.html" class="">配置</a> 部分并添加你的启动脚本。</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/nushell/nushell.github.io/edit/main/zh-CN/book/custom_commands.md" rel="noopener noreferrer" target="_blank" aria-label="在GitHub上编辑此页面"><!--[--><!--]--> 在GitHub上编辑此页面 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!----><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: hustcer@outlook.com">Justin Ma</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: dandavison7@gmail.com">Dan Davison</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 30049909+Hofer-Julian@users.noreply.github.com">Hofer-Julian</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: pedromfedricci@gmail.com">Pedro de Matos Fedricci</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/zh-CN/book/aliases.html" class="" aria-label="别名"><!--[--><!--]--> 别名 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-c9a81c0f.js" defer></script>
  </body>
</html>
